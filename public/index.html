<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Flow - 智能学习计时器</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="基于神经科学原理的智能学习计时器">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --radius: 16px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* 背景动画 */
        body::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: backgroundMove 60s linear infinite;
            opacity: 0.3;
        }

        @keyframes backgroundMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            padding: 40px;
            position: relative;
            z-index: 1;
        }

        /* 标题区域 */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        /* 主要内容区域 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* 计时器显示区域 */
        .timer-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--radius);
            padding: 40px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .timer-display::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .timer-main {
            font-size: 4rem;
            font-weight: 300;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            letter-spacing: 0.05em;
        }

        .timer-status {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .timer-sub {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .timer-item {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .timer-item-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .timer-item-time {
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* 设置面板 */
        .settings-panel {
            background: var(--light);
            border-radius: var(--radius);
            padding: 30px;
        }

        .setting-group {
            margin-bottom: 25px;
        }

        .setting-group:last-child {
            margin-bottom: 0;
        }

        .setting-label {
            display: flex;
            align-items: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .setting-label svg {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            color: var(--primary);
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-input-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .time-input {
            width: 60px;
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            text-align: center;
            transition: var(--transition);
        }

        .time-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .time-unit {
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* 控制按钮 */
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px 0 rgba(99, 102, 241, 0.6);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: var(--light);
            border-color: #d1d5db;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* 进度条 */
        .progress-container {
            margin-top: 30px;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(100px); }
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #6b7280;
        }

        /* 预设模板 */
        .presets {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 999px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .preset-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .preset-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* 音频设置模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--light);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-btn:hover {
            background: #e5e7eb;
        }

        /* 音频列表 */
        .audio-list {
            margin-top: 20px;
        }

        .audio-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--light);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
        }

        .audio-item:hover {
            background: #e5e7eb;
        }

        .audio-name {
            flex: 1;
            margin-right: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 8px;
        }

        /* 音频预设选项 */
        .audio-presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .audio-option {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .audio-option:hover {
            border-color: var(--primary);
        }

        .audio-option input[type="radio"] {
            margin-right: 8px;
        }

        .audio-option input[type="radio"]:checked + span {
            color: var(--primary);
            font-weight: 600;
        }

        /* 音量控制 */
        .volume-control {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: var(--radius-sm);
        }

        .volume-slider {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .timer-main {
                font-size: 3rem;
            }

            .controls {
                flex-wrap: wrap;
            }

            .btn {
                flex: 1;
                min-width: 120px;
            }
        }

        /* 加载动画 */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 通知提示 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 2000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 标题区域 -->
        <div class="header">
            <h1>Focus Flow</h1>
            <p>基于神经科学的智能学习计时器</p>
        </div>

        <!-- 预设模板 -->
        <div class="presets">
            <button class="preset-btn" onclick="loadPreset('pomodoro')">番茄工作法</button>
            <button class="preset-btn" onclick="loadPreset('deepwork')">深度工作</button>
            <button class="preset-btn" onclick="loadPreset('study')">考试复习</button>
            <button class="preset-btn" onclick="loadPreset('custom')">自定义</button>
        </div>

        <!-- 主要内容区域 -->
        <div class="main-content">
            <!-- 计时器显示 -->
            <div class="timer-display">
                <div class="timer-main" id="mainTimer">00:00:00</div>
                <div class="timer-status" id="timerStatus">准备开始</div>
                <div class="timer-sub">
                    <div class="timer-item">
                        <div class="timer-item-label">阶段时间</div>
                        <div class="timer-item-time" id="stageTimer">00:00:00</div>
                    </div>
                    <div class="timer-item">
                        <div class="timer-item-label">休息时间</div>
                        <div class="timer-item-time" id="breakTimer">00:00:00</div>
                    </div>
                </div>
            </div>

            <!-- 设置面板 -->
            <div class="settings-panel">
                <div class="setting-group">
                    <div class="setting-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        总时间
                    </div>
                    <div class="time-inputs">
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="totalHours" value="2" min="0" max="23">
                            <span class="time-unit">时</span>
                        </div>
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="totalMinutes" value="0" min="0" max="59">
                            <span class="time-unit">分</span>
                        </div>
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="totalSeconds" value="0" min="0" max="59">
                            <span class="time-unit">秒</span>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        阶段时间
                    </div>
                    <div class="time-inputs">
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="stageHours" value="0" min="0" max="23">
                            <span class="time-unit">时</span>
                        </div>
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="stageMinutes" value="25" min="0" max="59">
                            <span class="time-unit">分</span>
                        </div>
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="stageSeconds" value="0" min="0" max="59">
                            <span class="time-unit">秒</span>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        随机提醒间隔
                    </div>
                    <div class="time-inputs">
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="randomMin" value="3" min="1" max="60">
                            <span class="time-unit">分钟</span>
                        </div>
                        <span style="margin: 0 10px;">-</span>
                        <div class="time-input-group">
                            <input type="number" class="time-input" id="randomMax" value="5" min="1" max="60">
                            <span class="time-unit">分钟</span>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                        休息时间设置
                    </div>
                    <div style="margin-left: 28px;">
                        <div style="margin-bottom: 10px;">
                            <span style="font-size: 0.9rem; color: #6b7280;">短休息：</span>
                            <div class="time-inputs" style="display: inline-flex; margin-left: 10px;">
                                <div class="time-input-group">
                                    <input type="number" class="time-input" id="shortBreakMinutes" value="0" min="0" max="59">
                                    <span class="time-unit">分</span>
                                </div>
                                <div class="time-input-group">
                                    <input type="number" class="time-input" id="shortBreakSeconds" value="10" min="0" max="59">
                                    <span class="time-unit">秒</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span style="font-size: 0.9rem; color: #6b7280;">阶段休息：</span>
                            <div class="time-inputs" style="display: inline-flex; margin-left: 10px;">
                                <div class="time-input-group">
                                    <input type="number" class="time-input" id="stageBreakMinutes" value="5" min="0" max="59">
                                    <span class="time-unit">分</span>
                                </div>
                                <div class="time-input-group">
                                    <input type="number" class="time-input" id="stageBreakSeconds" value="0" min="0" max="59">
                                    <span class="time-unit">秒</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 进度条 -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="totalProgress" style="width: 0%"></div>
            </div>
            <div class="progress-label">
                <span>总进度</span>
                <span id="totalProgressText">0%</span>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="stageProgress" style="width: 0%"></div>
            </div>
            <div class="progress-label">
                <span id="stageProgressLabel">阶段进度</span>
                <span id="stageProgressText">0%</span>
            </div>
        </div>

        <!-- 控制按钮 -->
        <div class="controls">
            <button class="btn btn-primary" id="startBtn" onclick="handleStartPause()">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                </svg>
                开始学习
            </button>
            <button class="btn btn-secondary" id="resetBtn" onclick="resetTimer()" disabled>
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                </svg>
                重置
            </button>
            <button class="btn btn-secondary" onclick="openSettings()">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                </svg>
                音频设置
            </button>
        </div>
    </div>

    <!-- 音频设置模态框 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">音频设置</h2>
                <button class="close-btn" onclick="closeSettings()">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="audio-list">
                <p style="color: #6b7280; margin-bottom: 15px;">请将音频文件放入 notification 文件夹中</p>
                <div class="audio-item">
                    <span class="audio-name">开始提醒音</span>
                    <div class="audio-controls">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">选择</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">播放</button>
                    </div>
                </div>
                <div class="audio-item">
                    <span class="audio-name">随机提醒音</span>
                    <div class="audio-controls">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">选择</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">播放</button>
                    </div>
                </div>
                <div class="audio-item">
                    <span class="audio-name">阶段休息音</span>
                    <div class="audio-controls">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">选择</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">播放</button>
                    </div>
                </div>
                <div class="audio-item">
                    <span class="audio-name">结束提醒音</span>
                    <div class="audio-controls">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">选择</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;">播放</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div class="notification" id="notification">
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>
        <span id="notificationText">设置已保存</span>
    </div>

    <script>
        // 应用状态
        const state = {
            isRunning: false,
            isPaused: false,
            currentPhase: 'ready', // ready, stage, shortBreak, stageBreak
            totalTimeLeft: 0,
            stageTimeLeft: 0,
            breakTimeLeft: 0,
            nextReminderTime: 0,
            config: {
                totalTime: { hours: 2, minutes: 0, seconds: 0 },
                stageTime: { hours: 0, minutes: 25, seconds: 0 },
                randomReminder: { min: 3, max: 5 },
                shortBreak: { minutes: 0, seconds: 10 },
                stageBreak: { minutes: 5, seconds: 0 }
            }
        };

        let timerInterval = null;

        // 预设配置
        const presets = {
            pomodoro: {
                totalTime: { hours: 2, minutes: 0, seconds: 0 },
                stageTime: { hours: 0, minutes: 25, seconds: 0 },
                randomReminder: { min: 3, max: 5 },
                shortBreak: { minutes: 0, seconds: 10 },
                stageBreak: { minutes: 5, seconds: 0 }
            },
            deepwork: {
                totalTime: { hours: 4, minutes: 0, seconds: 0 },
                stageTime: { hours: 1, minutes: 30, seconds: 0 },
                randomReminder: { min: 5, max: 10 },
                shortBreak: { minutes: 0, seconds: 15 },
                stageBreak: { minutes: 15, seconds: 0 }
            },
            study: {
                totalTime: { hours: 3, minutes: 0, seconds: 0 },
                stageTime: { hours: 0, minutes: 45, seconds: 0 },
                randomReminder: { min: 4, max: 7 },
                shortBreak: { minutes: 0, seconds: 10 },
                stageBreak: { minutes: 10, seconds: 0 }
            }
        };

        // 加载预设
        function loadPreset(presetName) {
            if (presetName === 'custom') {
                // 自定义模式，不改变当前设置
                return;
            }

            const preset = presets[presetName];
            if (!preset) return;

            // 更新输入框
            document.getElementById('totalHours').value = preset.totalTime.hours;
            document.getElementById('totalMinutes').value = preset.totalTime.minutes;
            document.getElementById('totalSeconds').value = preset.totalTime.seconds;
            
            document.getElementById('stageHours').value = preset.stageTime.hours;
            document.getElementById('stageMinutes').value = preset.stageTime.minutes;
            document.getElementById('stageSeconds').value = preset.stageTime.seconds;
            
            document.getElementById('randomMin').value = preset.randomReminder.min;
            document.getElementById('randomMax').value = preset.randomReminder.max;
            
            document.getElementById('shortBreakMinutes').value = preset.shortBreak.minutes;
            document.getElementById('shortBreakSeconds').value = preset.shortBreak.seconds;
            
            document.getElementById('stageBreakMinutes').value = preset.stageBreak.minutes;
            document.getElementById('stageBreakSeconds').value = preset.stageBreak.seconds;

            // 更新预设按钮状态
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            showNotification('预设已加载', 'info');
        }

        // 格式化时间显示
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // 更新显示
        function updateDisplay() {
            document.getElementById('mainTimer').textContent = formatTime(state.totalTimeLeft);
            document.getElementById('stageTimer').textContent = formatTime(state.stageTimeLeft);
            document.getElementById('breakTimer').textContent = formatTime(state.breakTimeLeft);

            // 更新状态文本
            const statusMap = {
                'ready': '准备开始',
                'stage': '专注学习中',
                'shortBreak': '短暂回顾',
                'stageBreak': '阶段休息'
            };
            document.getElementById('timerStatus').textContent = statusMap[state.currentPhase];

            // 更新进度条
            if (state.config.totalTime) {
                const totalSeconds = state.config.totalTime.hours * 3600 + 
                                   state.config.totalTime.minutes * 60 + 
                                   state.config.totalTime.seconds;
                const totalProgress = totalSeconds > 0 ? 
                    ((totalSeconds - state.totalTimeLeft) / totalSeconds * 100) : 0;
                document.getElementById('totalProgress').style.width = `${totalProgress}%`;
                document.getElementById('totalProgressText').textContent = `${Math.round(totalProgress)}%`;
            }

            // 阶段进度
            if (state.currentPhase === 'stage') {
                const stageSeconds = state.config.stageTime.hours * 3600 + 
                                   state.config.stageTime.minutes * 60 + 
                                   state.config.stageTime.seconds;
                const stageProgress = stageSeconds > 0 ? 
                    ((stageSeconds - state.stageTimeLeft) / stageSeconds * 100) : 0;
                document.getElementById('stageProgress').style.width = `${stageProgress}%`;
                document.getElementById('stageProgressText').textContent = `${Math.round(stageProgress)}%`;
                document.getElementById('stageProgressLabel').textContent = '阶段进度';
            } else if (state.currentPhase === 'shortBreak' || state.currentPhase === 'stageBreak') {
                const breakType = state.currentPhase === 'shortBreak' ? 'shortBreak' : 'stageBreak';
                const breakSeconds = state.config[breakType].minutes * 60 + state.config[breakType].seconds;
                const breakProgress = breakSeconds > 0 ? 
                    ((breakSeconds - state.breakTimeLeft) / breakSeconds * 100) : 0;
                document.getElementById('stageProgress').style.width = `${breakProgress}%`;
                document.getElementById('stageProgressText').textContent = `${Math.round(breakProgress)}%`;
                document.getElementById('stageProgressLabel').textContent = '休息进度';
            }
        }

        // 获取配置
        function getConfig() {
            return {
                totalTime: {
                    hours: parseInt(document.getElementById('totalHours').value) || 0,
                    minutes: parseInt(document.getElementById('totalMinutes').value) || 0,
                    seconds: parseInt(document.getElementById('totalSeconds').value) || 0
                },
                stageTime: {
                    hours: parseInt(document.getElementById('stageHours').value) || 0,
                    minutes: parseInt(document.getElementById('stageMinutes').value) || 0,
                    seconds: parseInt(document.getElementById('stageSeconds').value) || 0
                },
                randomReminder: {
                    min: parseInt(document.getElementById('randomMin').value) || 3,
                    max: parseInt(document.getElementById('randomMax').value) || 5
                },
                shortBreak: {
                    minutes: parseInt(document.getElementById('shortBreakMinutes').value) || 0,
                    seconds: parseInt(document.getElementById('shortBreakSeconds').value) || 10
                },
                stageBreak: {
                    minutes: parseInt(document.getElementById('stageBreakMinutes').value) || 5,
                    seconds: parseInt(document.getElementById('stageBreakSeconds').value) || 0
                }
            };
        }

        // 开始/暂停处理
        function handleStartPause() {
            const btn = document.getElementById('startBtn');
            
            if (!state.isRunning) {
                // 开始计时
                state.config = getConfig();
                
                // 验证配置
                const totalSeconds = state.config.totalTime.hours * 3600 + 
                                   state.config.totalTime.minutes * 60 + 
                                   state.config.totalTime.seconds;
                const stageSeconds = state.config.stageTime.hours * 3600 + 
                                   state.config.stageTime.minutes * 60 + 
                                   state.config.stageTime.seconds;
                
                if (totalSeconds === 0 || stageSeconds === 0) {
                    showNotification('请设置总时间和阶段时间', 'error');
                    return;
                }

                // 初始化计时器
                state.totalTimeLeft = totalSeconds;
                state.stageTimeLeft = stageSeconds;
                state.breakTimeLeft = 0;
                state.currentPhase = 'stage';
                state.isRunning = true;
                state.isPaused = false;
                
                // 设置下次随机提醒时间
                const minSeconds = state.config.randomReminder.min * 60;
                const maxSeconds = state.config.randomReminder.max * 60;
                state.nextReminderTime = Math.floor(Math.random() * (maxSeconds - minSeconds + 1)) + minSeconds;

                // 更新按钮
                btn.innerHTML = `
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    暂停
                `;
                document.getElementById('resetBtn').disabled = false;

                // 开始计时
                startTimer();
                playSound('start');
                showNotification('计时开始！', 'success');
            } else if (!state.isPaused) {
                // 暂停
                state.isPaused = true;
                btn.innerHTML = `
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                    </svg>
                    继续
                `;
            } else {
                // 继续
                state.isPaused = false;
                btn.innerHTML = `
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    暂停
                `;
            }
        }

        // 开始计时器
        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            timerInterval = setInterval(() => {
                if (!state.isPaused && state.isRunning) {
                    // 总时间倒计时
                    if (state.totalTimeLeft > 0) {
                        state.totalTimeLeft--;
                    }

                    // 根据当前阶段处理
                    switch (state.currentPhase) {
                        case 'stage':
                            if (state.stageTimeLeft > 0) {
                                state.stageTimeLeft--;
                                state.nextReminderTime--;

                                // 检查是否需要随机提醒
                                if (state.nextReminderTime <= 0) {
                                    playSound('random');
                                    state.currentPhase = 'shortBreak';
                                    state.breakTimeLeft = state.config.shortBreak.minutes * 60 + 
                                                        state.config.shortBreak.seconds;
                                    showNotification('时间到！闭眼回顾一下刚才的内容', 'info');
                                }
                            } else {
                                // 阶段结束
                                playSound('stageBreak');
                                state.currentPhase = 'stageBreak';
                                state.breakTimeLeft = state.config.stageBreak.minutes * 60 + 
                                                    state.config.stageBreak.seconds;
                                showNotification('阶段完成！休息一下吧', 'success');
                            }
                            break;

                        case 'shortBreak':
                            if (state.breakTimeLeft > 0) {
                                state.breakTimeLeft--;
                            } else {
                                // 短休息结束，继续学习
                                playSound('start');
                                state.currentPhase = 'stage';
                                // 重新设置随机提醒时间
                                const minSeconds = state.config.randomReminder.min * 60;
                                const maxSeconds = state.config.randomReminder.max * 60;
                                state.nextReminderTime = Math.floor(Math.random() * (maxSeconds - minSeconds + 1)) + minSeconds;
                                showNotification('继续学习！', 'info');
                            }
                            break;

                        case 'stageBreak':
                            if (state.breakTimeLeft > 0) {
                                state.breakTimeLeft--;
                            } else {
                                // 阶段休息结束
                                if (state.totalTimeLeft > 0) {
                                    playSound('start');
                                    state.currentPhase = 'stage';
                                    state.stageTimeLeft = state.config.stageTime.hours * 3600 + 
                                                        state.config.stageTime.minutes * 60 + 
                                                        state.config.stageTime.seconds;
                                    // 重新设置随机提醒时间
                                    const minSeconds = state.config.randomReminder.min * 60;
                                    const maxSeconds = state.config.randomReminder.max * 60;
                                    state.nextReminderTime = Math.floor(Math.random() * (maxSeconds - minSeconds + 1)) + minSeconds;
                                    showNotification('新的学习阶段开始！', 'info');
                                }
                            }
                            break;
                    }

                    // 检查是否全部结束
                    if (state.totalTimeLeft <= 0) {
                        playSound('end');
                        resetTimer();
                        showNotification('学习完成！恭喜你！', 'success');
                    }

                    updateDisplay();
                }
            }, 1000);
        }

        // 重置计时器
        function resetTimer() {
            state.isRunning = false;
            state.isPaused = false;
            state.currentPhase = 'ready';
            state.totalTimeLeft = 0;
            state.stageTimeLeft = 0;
            state.breakTimeLeft = 0;
            state.nextReminderTime = 0;

            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            const btn = document.getElementById('startBtn');
            btn.innerHTML = `
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                </svg>
                开始学习
            `;
            document.getElementById('resetBtn').disabled = true;

            updateDisplay();
        }

        // 音频生成器类
        class AudioGenerator {
            constructor() {
                this.audioContext = null;
                this.masterVolume = 0.3;
                this.presets = {
                    electronic: {
                        start: { type: 'square', freqs: [440, 880], duration: 0.3 },
                        random: { type: 'sine', freqs: [523.25, 659.25, 783.99], duration: 0.5 },
                        stageBreak: { type: 'triangle', freqs: [261.63, 329.63, 392.00], duration: 1 },
                        end: { type: 'square', freqs: [523.25, 659.25, 783.99, 1046.5], duration: 0.8 }
                    },
                    piano: {
                        start: { type: 'sine', freqs: [261.63, 329.63, 392.00, 523.25], duration: 0.5 },
                        random: { type: 'sine', freqs: [440, 554.37, 659.25], duration: 0.4 },
                        stageBreak: { type: 'sine', freqs: [329.63, 392.00, 493.88], duration: 0.8 },
                        end: { type: 'sine', freqs: [523.25, 659.25, 783.99, 1046.5], duration: 1 }
                    },
                    nature: {
                        start: { type: 'sine', freqs: [396, 528, 639], duration: 0.6 },
                        random: { type: 'sine', freqs: [417, 528, 639], duration: 0.5 },
                        stageBreak: { type: 'sine', freqs: [174.61, 285, 396], duration: 1.2 },
                        end: { type: 'sine', freqs: [528, 639, 741, 852], duration: 1.5 }
                    }
                };
                this.currentPreset = 'electronic';
            }

            init() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            playSound(type) {
                this.init();
                const preset = this.presets[this.currentPreset][type];
                if (!preset) return;

                const now = this.audioContext.currentTime;
                
                if (type === 'random') {
                    // 随机提醒音 - 柔和的钟声效果
                    preset.freqs.forEach((freq, index) => {
                        this.playTone(freq, now + index * 0.1, 0.15, preset.type, 0.5);
                    });
                } else if (type === 'start') {
                    // 开始音 - 上升音调
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(this.audioContext.destination);
                    
                    osc.type = preset.type;
                    osc.frequency.setValueAtTime(preset.freqs[0], now);
                    osc.frequency.exponentialRampToValueAtTime(preset.freqs[1], now + preset.duration);
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(this.masterVolume, now + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + preset.duration);
                    
                    osc.start(now);
                    osc.stop(now + preset.duration);
                } else if (type === 'stageBreak') {
                    // 休息音 - 和弦
                    preset.freqs.forEach(freq => {
                        this.playTone(freq, now, this.masterVolume * 0.5, preset.type, preset.duration);
                    });
                } else if (type === 'end') {
                    // 结束音 - 胜利旋律
                    preset.freqs.forEach((freq, index) => {
                        const delay = index * 0.2;
                        this.playTone(freq, now + delay, this.masterVolume * 0.7, preset.type, 0.2);
                    });
                }

                // 视觉反馈
                const display = document.querySelector('.timer-display');
                display.style.animation = 'pulse 0.5s ease-out';
                setTimeout(() => {
                    display.style.animation = '';
                }, 500);
            }

            playTone(frequency, startTime, volume, type, duration) {
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(this.audioContext.destination);
                
                osc.type = type;
                osc.frequency.value = frequency;
                
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(volume, startTime + 0.02);
                gain.gain.linearRampToValueAtTime(volume, startTime + duration - 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                
                osc.start(startTime);
                osc.stop(startTime + duration);
            }

            setPreset(preset) {
                if (this.presets[preset]) {
                    this.currentPreset = preset;
                }
            }

            setVolume(volume) {
                this.masterVolume = Math.max(0, Math.min(1, volume));
            }
        }

        // 创建音频生成器实例
        const audioGenerator = new AudioGenerator();

        // 播放音效
        function playSound(type) {
            audioGenerator.playSound(type);
        }

        // 显示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notification.className = `notification ${type}`;
            notificationText.textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 打开设置
        function openSettings() {
            document.getElementById('settingsModal').classList.add('show');
        }

        // 关闭设置
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }

        // 初始化
        updateDisplay();

        // 键盘快捷键
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                handleStartPause();
            } else if (e.code === 'KeyR' && e.ctrlKey) {
                e.preventDefault();
                if (confirm('确定要重置计时器吗？')) {
                    resetTimer();
                }
            }
        });

        // 防止误关闭
        window.addEventListener('beforeunload', (e) => {
            if (state.isRunning) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // 保存配置到 localStorage
        function saveConfig() {
            const config = getConfig();
            localStorage.setItem('timerConfig', JSON.stringify(config));
        }

        // 加载配置
        function loadConfig() {
            const saved = localStorage.getItem('timerConfig');
            if (saved) {
                const config = JSON.parse(saved);
                // 应用配置到输入框
                document.getElementById('totalHours').value = config.totalTime.hours;
                document.getElementById('totalMinutes').value = config.totalTime.minutes;
                document.getElementById('totalSeconds').value = config.totalTime.seconds;
                // ... 其他配置项
            }
        }

        // 页面加载时读取配置
        window.addEventListener('load', loadConfig);

        // 输入改变时保存配置
        document.querySelectorAll('.time-input').forEach(input => {
            input.addEventListener('change', saveConfig);
        });

        // 注册 Service Worker (PWA支持)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker 注册成功:', registration);
                    })
                    .catch(err => {
                        console.log('Service Worker 注册失败:', err);
                    });
            });
        }

        // PWA安装提示
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // 可以在这里显示自定义的安装提示
        });

        // Electron环境检测和集成
        if (typeof require !== 'undefined') {
            const { ipcRenderer } = require('electron');
            
            // 监听来自主进程的消息
            ipcRenderer.on('toggle-timer', () => {
                handleStartPause();
            });
            
            ipcRenderer.on('reset-timer', () => {
                if (confirm('确定要重置计时器吗？')) {
                    resetTimer();
                }
            });
            
            ipcRenderer.on('open-settings', () => {
                openSettings();
            });
            
            // 加载Electron环境下的配置
            ipcRenderer.invoke('load-config').then(config => {
                if (config) {
                    // 应用配置
                    Object.assign(state.config, config);
                }
            });
        }
    </script>
</body>
</html>